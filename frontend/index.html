<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Journy.io Node.js SDK demo</title>
    <meta charset="utf-8" />
    <link href="includes/css/bootstrap.min.css" rel="stylesheet" />
    <script src="includes/js/jquery.min.js"></script>
    <script src="includes/js/bootstrap.min.js"></script>
    <!-- TODO: Add Journy tracker -->
  </head>
  <body>
    <div class="container my-5 col-12">
      <div class="my-2" id="form-required" hidden>
        <div class="alert alert-danger" role="alert">
          All fields are required. Please fill them in correctly.
        </div>
      </div>
      <div class="my-2" id="form-submitted" hidden>
        <div class="alert alert-success" role="alert">
          Your form was successfully received. Thank you for filling it in.
        </div>
      </div>
      <div class="my-2" id="form-error" hidden>
        <div class="alert alert-warning" role="alert">
          There went something wrong submitting your information. Please try
          again later.
        </div>
      </div>
      <div class="card p-5">
        <form class="col-12">
          <div class="form-group">
            <label for="email">Email address pet owner</label>
            <input
              class="form-control"
              id="email"
              placeholder="name@example.com"
              type="email"
              required
            />
          </div>
          <div class="form-group">
            <label for="pet-name">Pet name</label>
            <input
              class="form-control"
              id="pet-name"
              placeholder="name"
              type="text"
              required
            />
          </div>
          <div class="form-group">
            <label for="pet-species">Pet species</label>
            <input
              class="form-control"
              id="pet-species"
              placeholder="species"
              type="text"
              required
            />
          </div>
          <div class="form-group">
            <label for="pet-toys">Amount pet toys</label>
            <input
              class="form-control"
              id="pet-toys"
              placeholder="1"
              type="number"
              required
            />
          </div>
          <div class="form-group">
            <label for="pet-date">Pet date of birth</label>
            <input class="form-control" id="pet-date" type="date" required />
          </div>
          <div class="form-check">
            <input class="form-check-input" id="pet-insured" type="checkbox" />
            <label class="form-check-label" for="pet-insured"
              >Pet insured</label
            >
          </div>
          <div class="text-right">
            <button class="btn btn-primary" id="submit-form" type="submit">
              Send
            </button>
          </div>
        </form>
      </div>
    </div>
    <script>
      const required = $("#form-required");
      const submitted = $("#form-submitted");
      const error = $("#form-error");

      $("#submit-form").click((event) => {
        event.preventDefault();
        required.attr("hidden", true);
        submitted.attr("hidden", true);
        error.attr("hidden", true);

        const postData = {
          email: $("#email").val(),
          petName: $("#pet-name").val(),
          petSpecies: $("#pet-species").val(),
          petToys: parseInt($("#pet-toys").val()),
          petDate: new Date($("#pet-date").val()).toISOString(),
          petInsured: $("#pet-insured").is(":checked"),
        };

        if (!isValidForm(postData)) {
          required.attr("hidden", false);
          return;
        }

        $.ajax({
          type: "POST",
          url: "http://localhost:3001/pet-information",
          data: JSON.stringify(postData),
          success: () => submitted.attr("hidden", false),
          error: () => error.attr("hidden", false),
          dataType: "json",
          contentType: "application/json",
        });
      });

      function isValidForm(data) {
        return (
          data.email.trim().length > 0 &&
          data.petName.trim().length > 0 &&
          data.petSpecies.trim().length > 0 &&
          data.petDate &&
          data.petDate.trim().length > 0 &&
          !isNaN(data.petToys)
        );
      }
    </script>
  </body>
</html>
